<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone Editor</title>
    <style>
        .canvas-area {
            position: relative;
            min-height: 600px;
            border: 2px solid #ccc;
            margin: 20px;
            overflow: hidden;
        }

        .element-container {
            position: absolute;
            transition: transform 0.1s;
        }

        .element-container:hover .controls {
            opacity: 1;
        }

        .controls {
            position: absolute;
            top: -30px;
            right: 0;
            background: white;
            padding: 4px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.2s;
            display: flex;
            gap: 4px;
        }

        .drag-handle {
            position: absolute;
            top: -8px;
            left: 0;
            width: 32px;
            height: 32px;
            background: #666;
            color: white;
            border-radius: 50%;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .element-container:hover .drag-handle {
            opacity: 1;
        }

        .control-button {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-button.copy { background: #22c55e; }
        .control-button.settings { background: #666; }
        .control-button.delete { background: #ef4444; }
        .control-button.visibility { background: #3b82f6; }
    </style>
</head>
<body>
    <div class="controls-panel">
        <input type="file" id="bgInput" accept="image/*" style="display: none">
        <button onclick="document.getElementById('bgInput').click()">Choose Background</button>
        <button onclick="toggleAllElements()">Show/Hide All</button>
        <button onclick="addNewElement()">Add Element</button>
    </div>

    <div id="canvas" class="canvas-area"></div>

    <script>
        let elements = [];
        let isDragging = false;
        let currentElement = null;
        let offset = { x: 0, y: 0 };
        
        // Load saved elements from localStorage
        function loadSavedElements() {
            const saved = localStorage.getItem('canvasElements');
            if (saved) {
                elements = JSON.parse(saved);
                renderElements();
            }
        }

        // Save elements to localStorage
        function saveElements() {
            localStorage.setItem('canvasElements', JSON.stringify(elements));
        }

        function addNewElement() {
            const element = {
                id: Date.now(),
                type: 'text',
                content: 'New Text',
                x: 20,
                y: 20,
                visible: true,
                style: {
                    color: '#000000',
                    backgroundColor: '#ffffff',
                    fontSize: '16px'
                }
            };
            elements.push(element);
            renderElements();
            saveElements();
        }

        function createElementDOM(element) {
            const container = document.createElement('div');
            container.className = 'element-container';
            container.style.left = `${element.x}%`;
            container.style.top = `${element.y}%`;
            container.style.opacity = element.visible ? '1' : '0.3';

            // Add drag handle
            const dragHandle = document.createElement('div');
            dragHandle.className = 'drag-handle';
            dragHandle.innerHTML = '‚Üî';
            dragHandle.onmousedown = (e) => startDrag(e, element);
            container.appendChild(dragHandle);

            // Add controls
            const controls = document.createElement('div');
            controls.className = 'controls';
            controls.innerHTML = `
                <button class="control-button copy" onclick="copyElement(${element.id})">üìã</button>
                <button class="control-button visibility" onclick="toggleElement(${element.id})">üëÅ</button>
                <button class="control-button settings" onclick="openSettings(${element.id})">‚öôÔ∏è</button>
                <button class="control-button delete" onclick="deleteElement(${element.id})">√ó</button>
            `;
            container.appendChild(controls);

            // Add content
            const content = document.createElement('div');
            content.innerHTML = element.content;
            content.style.color = element.style.color;
            content.style.backgroundColor = element.style.backgroundColor;
            content.style.fontSize = element.style.fontSize;
            container.appendChild(content);

            return container;
        }

        function renderElements() {
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = '';
            elements.forEach(element => {
                canvas.appendChild(createElementDOM(element));
            });
        }

        function startDrag(e, element) {
            isDragging = true;
            currentElement = element;
            const rect = e.target.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;
        }

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            
            const x = ((e.clientX - rect.left - offset.x) / rect.width) * 100;
            const y = ((e.clientY - rect.top - offset.y) / rect.height) * 100;
            
            currentElement.x = Math.max(0, Math.min(100, x));
            currentElement.y = Math.max(0, Math.min(100, y));
            
            renderElements();
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                saveElements();
            }
        });

        // Handle background image
        document.getElementById('bgInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const canvas = document.getElementById('canvas');
                    canvas.style.backgroundImage = `url(${e.target.result})`;
                    canvas.style.backgroundSize = 'contain';
                    canvas.style.backgroundRepeat = 'no-repeat';
                    canvas.style.backgroundPosition = 'center';
                    localStorage.setItem('backgroundImage', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // Initialize
        window.onload = () => {
            loadSavedElements();
            const savedBg = localStorage.getItem('backgroundImage');
            if (savedBg) {
                const canvas = document.getElementById('canvas');
                canvas.style.backgroundImage = `url(${savedBg})`;
                canvas.style.backgroundSize = 'contain';
                canvas.style.backgroundRepeat = 'no-repeat';
                canvas.style.backgroundPosition = 'center';
            }
        };
    </script>
</body>
</html>