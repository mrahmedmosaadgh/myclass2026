# Weekly Plan System - Database Tables & Relationships

## ğŸ“Š Tables to Create

### 1. weekly_plans
**Purpose**: Container for weekly plans per class-subject-week combination

| Field | Type | Description |
|-------|------|-------------|
| `id` | bigint | Primary key |
| `academic_year_id` | bigint | Foreign key to academic_years |
| `semester_number` | integer | Semester number (1 or 2) |
| `week_number` | integer | Week number (1-18 or 1-36) |
| `cst_id` | bigint | Foreign key to classroom_subject_teachers |
| `created_at` | timestamp | Creation timestamp |
| `updated_at` | timestamp | Last update timestamp |

### 2. weekly_plan_sessions
**Purpose**: Individual editable sessions within a weekly plan

| Field | Type | Description |
|-------|------|-------------|
| `id` | bigint | Primary key |
| `weekly_plan_id` | bigint | Foreign key to weekly_plans |
| `session_index` | integer | Order within week (1, 2, 3...) |
| `period_code` | string | Soft reference format: academic_year.semester.week.day |
| `type` | enum | Session type: lesson, quiz, exam, extra, note |
| `title` | string | Session title/name |
| `data` | json | Flexible storage for materials, zoom links, homework, skill tags |
| `created_at` | timestamp | Creation timestamp |
| `updated_at` | timestamp | Last update timestamp |

## ğŸ”— Relationships

### Existing Tables (Referenced)
- **academic_years** (id, name, ...)
- **classroom_subject_teachers** (id, academic_year_id, classroom_id, subject_id, teacher_id, classes_per_week, ...)

### New Relationships
```
weekly_plans
â”œâ”€â”€ belongsTo academic_years (academic_year_id)
â”œâ”€â”€ belongsTo classroom_subject_teachers (cst_id)
â””â”€â”€ hasMany weekly_plan_sessions

weekly_plan_sessions
â”œâ”€â”€ belongsTo weekly_plans (weekly_plan_id)
â””â”€â”€ morphToMany (via data JSON for flexible attachments)
```

## ğŸ¯ Key Design Decisions

### Period Code Format
- **Format**: `academic_year.semester.week.day`
- **Example**: `25.1.2.5` = Academic year 2025, Semester 1, Week 2, Day 5
- **Purpose**: Soft reference that can be updated without breaking relationships

### Session Index Logic
- **Scope**: Resets per week (starts from 1 each week)
- **Purpose**: Allows reordering within each week independently

### Data Field Structure (JSON)
```json
{
  "materials": ["file1.pdf", "video2.mp4"],
  "zoom_link": "https://zoom.us/j/123456789",
  "homework": "Complete exercises 1-5",
  "skill_tags": ["algebra", "equations"],
  "duration_minutes": 45,
  "notes": "Bring calculator"
}
```

## ğŸ”„ Integration Points
- **Fixed Schedule**: Can be used to auto-populate initial plans
- **Lessons Table**: Optional source for initial session content
- **User Permissions**: Teachers can only edit their assigned cst_id plans
- **Academic Year**: Plans are isolated by academic_year_id

## ğŸ“ File Structure
```
weeklyplansystem/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 2025_07_18_000001_create_weekly_plans_table.php
â”‚   â””â”€â”€ 2025_07_18_000002_create_weekly_plan_sessions_table.php
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ WeeklyPlan.php
â”‚   â””â”€â”€ WeeklyPlanSession.php
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ WeeklyPlanController.php
â”‚   â””â”€â”€ WeeklyPlanSessionController.php
â”œâ”€â”€ requests/
â”‚   â”œâ”€â”€ StoreWeeklyPlanRequest.php
â”‚   â”œâ”€â”€ UpdateWeeklyPlanRequest.php
â”‚   â”œâ”€â”€ StoreWeeklyPlanSessionRequest.php
â”‚   â””â”€â”€ UpdateWeeklyPlanSessionRequest.php
â””â”€â”€ VuePages/
    â”œâ”€â”€ WeeklyPlanIndex.vue
    â”œâ”€â”€ WeeklyPlanEdit.vue
    â””â”€â”€ components/
        â”œâ”€â”€ WeeklyPlanWeek.vue
        â”œâ”€â”€ WeeklyPlanSessionCard.vue
        â””â”€â”€ WeeklyPlanSessionModal.vue